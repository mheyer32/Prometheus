# makefile for GNU make (automatically generated by makemake)
# NOTE: indent with TAB in GNU makefiles!

# paths are relative to the project directory (current directory during make)

OBJDIR = _out/gcc/
BINDIR = _bin/gcc/
LIBRARY = $(BINDIR)/prometheus.library

TESTEXE = $(BINDIR)/prometheus.exe
TESTOBJDIR = _out/gcc/test/

# compiler and linker

CC = m68k-amigaos-gcc
LD = m68k-amigaos-gcc
STRIP = m68k-amigaos-strip

CFLAGS ?= 
CFLAGS += -noixemul -m68020-60 -O2 -g -ggdb -DAMIGAOS3 -I./include -I../PrometheusCard
LDFLAGS ?=
LDFLAGS += -g -ggdb

# target 'all' (default target)

all : $(LIBRARY) $(TESTEXE)

dirs:
	mkdir -p $(OBJDIR)
	mkdir -p $(BINDIR)
	mkdir -p $(TESTOBJDIR)

%driver_2.o : driver_2.c dirs
	$(CC) $(CFLAGS) -c $< -o $@

OBJS = $(OBJDIR)driver_2.o

$(LIBRARY) :
$(LIBRARY) : LDFLAGS+=-ramiga-lib -nostartfiles
$(LIBRARY) : $(OBJS)
	$(LD) $(LDFLAGS) $(OBJS) -o $(LIBRARY)_unstripped
	$(STRIP) $(LIBRARY)_unstripped -o $(LIBRARY)


TESTOBJS = $(TESTOBJDIR)driver_2.o

$(TESTEXE) : | dirs
$(TESTEXE) : CFLAGS+=-DTESTEXE
$(TESTEXE) : LDFLAGS+=
$(TESTEXE) : $(TESTOBJS)
	$(LD) $(LDFLAGS) $< -o $@_unstripped
	$(STRIP) $@_unstripped -o $@


# target 'clean'

clean:
	rm -f $(TESTEXE)
	rm -f $(LIBRARY)
	rm -rf $(OBJDIR)\*.o
	rm -rf $(TESTOBJDIR)\*.o
