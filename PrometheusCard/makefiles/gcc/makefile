# makefile for GNU make (automatically generated by makemake)
# NOTE: indent with TAB in GNU makefiles!

# paths are relative to the project directory (current directory during make)

OUTDIR = _bin/gcc/
LIBRARY = $(OUTDIR)Prometheus.card
OBJDIR = _o/gcc/

DEBUG ?= 0

# compiler and linker

CC = m68k-amigaos-gcc
LD = m68k-amigaos-gcc
STRIP = m68k-amigaos-strip

OBJS_NOPREFIX = card.o \
                card_3dfxvoodoo.o \
                card_3dlabspermedia2.o \
                card_s3trio64.o \
                card_s3virge.o \
                dma.o \
                vbcc_libinit.o

OBJS =$(addprefix $(OBJDIR), $(OBJS_NOPREFIX))

CFLAGS ?=
CFLAGS += -m68020-60 -Os -g -ggdb -fomit-frame-pointer -DAMIGAOS3 -I./ -I../PromLib/include
LDFLAGS ?=
LDFLAGS += -m68020-60 -Os -g -ggdb -ramiga-lib -nostartfiles


ifeq ($(DEBUG),1)
    CFLAGS += -DDBG
    LIBS += -ldebug
endif


# target 'all' (default target)

all : $(LIBRARY)

directories :
	mkdir -p $(OBJDIR)
	mkdir -p $(OUTDIR)

$(OBJS) : | directories

$(OBJDIR)%.o : %.c
	$(CC) $(CFLAGS) -c -o $@ $<

$(LIBRARY) : $(OBJS)
	$(LD) $(LDFLAGS) -o $@_unstripped $^ -ldebug
	$(STRIP) $@_unstripped -o $@

# target 'clean'

clean:
	rm -f $(LIBRARY)
	rm -rf $(OBJDIR)*.o
